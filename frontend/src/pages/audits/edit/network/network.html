<div>
    <breadcrumb
    buttons
    :title="audit?.name ? `${audit.name} (${audit.auditType || $t('msg.auditTypeNotSet')})` : 'Loading...'"
    :state="parentState"
    :approvals="parentApprovals"
  >
    <template v-slot:buttons>
      <div >
        <q-btn-dropdown class="q-mr-sm" :label="$t('import')" no-caps>
          <q-list>
            <q-item clickable @click="$refs.nmapFile.click()">
              <q-item-section>
                <q-item-label>
                  Nmap
                  <input
                    type="file"
                    ref="nmapFile"
                    accept=".xml"
                    class="hidden"
                    @change="importNetworkScan($event.target.files, 'nmap')"
                  />
                </q-item-label>
              </q-item-section>
            </q-item>
            <q-separator />
            <q-item clickable @click="$refs.nessusFile.click()">
              <q-item-section>
                <q-item-label>
                  Nessus
                  <input
                    type="file"
                    ref="nessusFile"
                    accept=".nessus"
                    class="hidden"
                    @change="importNetworkScan($event.target.files, 'nessus')"
                  />
                </q-item-label>
              </q-item-section>
            </q-item>
          </q-list>
        </q-btn-dropdown>
        <q-btn color="positive" :label="$t('btn.save') + ' (ctrl+s)'" no-caps @click="updateAuditNetwork" />
      </div>
    </template>
  </breadcrumb>
  
<div class="row q-col-gutter-md q-pa-md">
    <div class="col-md-6">
        <q-card>
            <q-card-section>{{$t('hostsAssociateScopes')}}</q-card-section>
            <q-separator />
            <q-card-section v-for="scope of audit.scope" :key="scope.name">
                    <span class="text-h6">{{scope.name}}</span>
                    <div class="q-col-gutter-md row">
                            <q-select
                            class="col-md-12"
                            multiple
                            :label="selectHostsLabel"
                            v-model="selectedTargets[scope.name]"
                            :options="targetsOptions"
                            use-chips
                            clearable
                            options-sanitize
                            >
                            <template v-slot:append>
                                <q-btn round dense flat icon="add" @click.close="updateScopeHosts(scope)" />
                              </template>
                            </q-select>
                            <div v-for="(host, index) of scope.hosts" :key="`${scope.name}-${host.ip || host}-${index}`" 
                                 @click="onHostClick(host, scope)"
                                 class="cursor-pointer">
                            <q-chip 
                            color="blue-grey-7"
                            text-color="white"
                            dense
                            square
                            class="col-md-6"
                            removable
                            @remove="scope.hosts.splice(index, 1)"
                            >
                            {{host.ip || host}}
                            </q-chip>
                        </div>
                    </div>
            </q-card-section>
        </q-card>
    </div>
    <div v-if="currentHost !== null" class="col-md-6">
        <q-table
        :title="`${currentHost.ip} (${currentHost.hostname})`"
        :rows="currentHost.services"
        :columns="dtHostHeaders"
        v-model:pagination="hostPagination"
        row-key="port"
        />
    </div>
</div>
</div>
